"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e){try{return window[e].call(this)}catch(e){console.log("error",e)}var t=new Object;return t.status="failed",t.msg="没有找到该方法",t}function n(e,n){_=new Object,e.find("i").hasClass("fa-thumbs-up")?_.praise_flag=1:_.praise_flag=0,_.comment_id=e.parent().parent().attr("comment_id");var a=t(n);if(console.log("commentCallback",a),"success"==a.status){e.find("i").removeClass("fa-thumbs-o-up"),e.find("i").addClass("fa-thumbs-up"),e.find("i").css("color","red");var r=parseInt(e.find("span").text());e.find("span").text(++r+"人点赞")}else"outnumber"==a.status?alert("不能重复点赞"):alert(a.msg)}function a(e,t){var n=m(e);t.find(".commentbox").length>0&&t.find(".commentbox").remove(),t.find(".child-comment-list").append(n)}function r(t,a,r,o,s,c,m){var l=d(a,o);o++;var f=e(l);return f.find(".praise_comment").click(function(){n(e(this),m)}),f.find(".reply_floor_host").click(function(){i(e(this),"parent",s,c)}),f.find(".reply_floor_child").click(function(){i(e(this),"child",s,c)}),"after"==r?t.append(f):t.prepend(f),o}function o(e,t,n){""==v?(v=t.replyUserName,s(e,t,n)):v!=t.replyUserName?(v=t.replyUserName,e.find(".commentbox").length>0?e.find(".commentbox>textarea").val("@"+t.replyUserName+" "):s(e,t,n)):e.find(".commentbox").length>0?e.find(".commentbox").remove():s(e,t,n)}function i(e,t,n,a){var r=e.parent().parent().find("a").first().text(),i=e.attr("uid"),s="";s="child"==t?e.parent().parent().parent().parent():e.parent().parent();var c=l();c.reply_user_id=i,c.userName=n,c.replyUserName=r,c.create_time=f(),c.parent_id=s.attr("comment_id"),console.log("reply",c),o(s,c,a)}function s(n,r,o){n.attr("comment_id");n.find(".child-comment-list").append(c(r)),n.find(".smile-reply").emoji({content_el:n.find(".child-comment-list>.commentbox>textarea"),list:[{name:"QQ表情",code:"qq_",path:_ctx+"/comment/face/emoji1/",suffix:".gif",max_number:75},{name:"emoji表情",code:"em_",path:_ctx+"/comment/face/emoji2/",suffix:".png",max_number:52}]}),n.find(".commentbox>.send-box>.btn-send").click(function(){var i=e(this).parent().prev().val();r.content=i.replace(i.split(" ",1),"");try{_=new Object,_=r,console.log("commentBody",r);var s=t(o);console.log("commentCallback",s),"success"==s.status?a(s.data,n):alert("error request")}catch(e){console.log("error",e)}})}function c(e){var t="<div class='commentbox'>";return t=t+"<textarea cols='80' rows='50' placeholder='来说几句吧......' class='mytextarea' id='reply-content'>@"+e.replyUserName+" </textarea>",t+="<div class='send-box'>",t+="<a href='javascript:void(0)' class='smile-reply'><i class='fa fa-smile-o'></i></a>",t+="<a href='javascript:void(0)' class='btn-send'>回复</a>",t+="</div></div>"}function d(e,t){e.content=u(e.content);var n="<div class='comment-list-box' comment_id='"+e.comment_id+"'>";if(n+="<header>",n=n+"<div class='author-head'><img src='"+e.userPath+"' /></div>",n+="<div class='author-info'>",n=n+"<a href='javascript:void(0)'>"+e.userName+"</a>",n+="<div class='authore-info-footer'>",n=n+"<span>"+t+"楼</span><span>"+e.create_time+"</span>",""!=e.address&&void 0!==e.address&&(n=n+"<span><i class='fa fa-map-marker'></i>"+e.address+"</span>"),n+="</div></div></header>",n=n+"<p class='content'>"+e.content+"</p>",n+="<footer>",""!=e.os_name&&void 0!==e.os_name&&(n=n+"<span><i class='fa fa-desktop'></i>"+e.os_name+"</span>"),""!=e.browse_version&&void 0!==e.browse_version&&(n=n+"<span><i class='fa fa-globe'></i>"+e.browse_version+"</span>"),n=n+"<a href='javascript:void(0)' class='reply_floor_host' uid='"+e.user_id+"'><i class='fa fa-mail-reply'></i><span>回复</span></a>",n=n+"<a href='javascript:void(0)' class='praise_comment'><i class='fa "+(1==e.praise_flag?"fa-thumbs-up red":"fa-thumbs-o-up")+"'></i><span>"+e.praise_num+"人点赞</span></a>",n+="</footer>",n+="<div class='child-comment-list'>",void 0!==e.replybody&&e.replybody.length>0)for(var a=0;a<e.replybody.length;a++){var r=e.replybody[a],o=m(r);n+=o}return n+="</div></div>"}function m(e){e.content=u(e.content);var t="<div class='child-comment'>";return t=t+"<p><a href='javascript:void(0)'>"+e.userName+"</a>:<a href='javascript:void(0)'>@"+e.replyUserName+"</a>"+e.content+"</p>",t+="<footer>",t=t+"<span>"+e.create_time+"</span>",t=t+"<a href='javascript:void(0)' class='reply_floor_child' uid='"+e.user_id+"'><i class='fa fa-mail-reply'></i><span>回复</span></a>",t+="</footer></div>"}function l(e,t,n,a,r,o,i,s,c,d,m,l,f,p){var u=new Object;return u.comment_id=_typeof("undefined"==e)?"":e,u.parent_id=_typeof("undefined"==t)?"":t,u.table_id=_typeof("undefined"==n)?"":n,u.user_id=_typeof("undefined"==a)?"":a,u.userName=_typeof("undefined"==r)?"":r,u.userPath=_typeof("undefined"==o)?"":o,u.replyUserName=_typeof("undefined"==c)?"":c,u.content=_typeof("undefined"==i)?"":i,u.reply_user_id=_typeof("undefined"==s)?"":s,u.praise_num=_typeof("undefined"==d)?"":d,u.address=_typeof("undefined"==m)?"":m,u.browse_version=_typeof("undefined"==l)?"":l,u.os_name=_typeof("undefined"==f)?"":f,u.create_time=_typeof("undefined"==p)?"":p,u}function f(){var e=new Date;return e.getFullYear()+"-"+p(e.getMonth()+1)+"-"+p(e.getDate())+" "+p(e.getHours())+":"+p(e.getMinutes())+":"+p(e.getSeconds())}function p(e){return e<10?"0"+e:e}function u(e){e=e.replace(/\n/g,"<br/>");var t=/\[qq_([0-9]*)\]/g,n=e.match(t);if(null!=n)for(var a=0;a<n.length;a++){var r=n[a].indexOf("_"),o=n[a].substring(r+1,n[a].length-1);o<=75&&o>0&&(e=e.replace(n[a],"<img src='/comment/face/emoji1/"+o+".gif' />"))}var i=/\[em_([0-9]*)\]/g,s=e.match(i);if(null!=s)for(var c=0;c<s.length;c++){var d=s[c].indexOf("_"),m=s[c].substring(d+1,s[c].length-1);m<=52&&o>0&&(e=e.replace(s[c],"<img src='/comment/face/emoji2/"+m+".png' />"))}return e}var _=new Object,v="";e.fn.initComment=function(t){var n={data:[],direction:"after",floorNum:1,userName:"帅大叔",reply_method:"addReplyRequest",praise_method:"praiseRequest"},a=e.extend(n,t),o=a.userName,i=a.floorNum,s=a.direction,c=a.reply_method,d=a.praise_method,m=a.data;if(void 0!==m&&m.length>0)for(var l=0;l<m.length;l++)i=r(e(this),m[l],s,i,o,c,d);return i},e.fn.comment=function(n){var a={obj:{},direction:"after",floorNum:1,userName:"帅大叔",comment_method:"addCommentRequest",reply_method:"addReplyRequest",praise_method:"praiseRequest"},o=e.extend(a,n),i=o.obj,s=o.direction,c=o.floorNum,d=o.comment_method,m=o.reply_method,l=o.praise_method;_=new Object,_=i;var f=t(d);return console.log("commentCallback",f),f&&"success"==f.status&&(c=r(e(this),f.data,s,c,userName,m,l)),c},e.fn.getCommentBody=function(){return _}}(jQuery);