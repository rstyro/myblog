"use strict";function addNode(t,e,a){var o=Robot(t,e),n=createNode(a,o),c=document.getElementById("chatBody").scrollHeight,s=c;bottomAnimate($("#chatBody"),s,500),$(".chat-body").append(n)}function CMD(t){return $("#chat-content").val(""),""!=t&&("指令"==t?(addNode(robotImg,"1.//:clear  --\x3e 清除聊天记录<br>2.指令   --\x3e 打印所有指令列表<br>","info-left"),!1):"时间"==t||"time"==t?(addNode(robotImg,getNowDateFormat(),"info-left"),!1):"//:clear"!=t||($(".chat-body").empty(),!1))}function requesAnswer(t){$.ajax({type:"post",url:_ctx+"/robot/answer",cache:!1,dataType:"json",data:{content:t,_t:(new Date).getTime()},success:function(t){"success"==t.status?addNode(robotImg,replace_em(t.data),"info-left"):addNode(robotImg,t.msg,"info-left"),$("#chat-content").val("")}})}function requesQuest(t,e){$.ajax({type:"post",url:_ctx+"/robot/question",cache:!1,dataType:"json",data:{question:t,answer:e,_t:(new Date).getTime()},success:function(t){"success"==t.status?($("#question").val(""),$("#answer").val("")):alert(t.msg)}})}function createNode(t,e){return"<div class='info "+t+"'><div class='info-header'><img src='"+e.head_path+"'/></div><span class='info-body'><span class='content'><em></em> "+e.content+"</span></span></div>"}function Robot(t,e){var a=new Object;return a.head_path=t,a.content=e,a}function bottomAnimate(t,e,a){t.stop().animate({scrollTop:e+"px"},a)}function htmlEncodeJQ(t){return $("<span/>").text(t).html()}function replace_em(t){t=t.replace(/\n/g,"<br/>");var e=/\[qq_([0-9]*)\]/g,a=t.match(e);if(null!=a)for(var o=0;o<a.length;o++){var n=a[o].indexOf("_"),c=a[o].substring(n+1,a[o].length-1);c<=75&&c>0&&(t=t.replace(a[o],"<img src='/comment/face/emoji1/"+c+".gif' />"))}var s=/\[em_([0-9]*)\]/g,r=t.match(s);if(null!=r)for(var i=0;i<r.length;i++){var l=r[i].indexOf("_"),d=r[i].substring(l+1,r[i].length-1);d<=52&&c>0&&(t=t.replace(r[i],"<img src='/comment/face/emoji2/"+d+".png' />"))}return t}function getNowDateFormat(){var t=new Date;return t.getFullYear()+"-"+filterNum(t.getMonth()+1)+"-"+filterNum(t.getDate())+" "+filterNum(t.getHours())+":"+filterNum(t.getMinutes())+":"+filterNum(t.getSeconds())}function filterNum(t){return t<10?"0"+t:t}var _ctx=$("meta[name='_ctx']").attr("content");_ctx=_ctx.substr(0,_ctx.length-1);var robotImg="/images/rebotImg/robot.png";$(function(){$("#fh5co-main-menu ul li:eq(5)").addClass("fh5co-active"),$(".main").css("min-height",$(window).height()-50+"px"),$("#wechatCode").click(function(){$("#myWechatCode").modal("show")}),$("[data-toggle='tooltip']").tooltip(),addNode(robotImg,"欢迎欢迎，热烈欢迎.....","info-left"),$("body").keydown(function(){if("13"==event.keyCode){var t=$("#chat-content").val();t=$.trim(t),CMD(t)&&(t=htmlEncodeJQ(t),addNode($("#user_path").val(),t,"info-right"),requesAnswer(t)),$("#chat-content").val("")}}),$("#sendBtn").click(function(){var t=$("#chat-content").val();t=$.trim(t),CMD(t)&&(t=htmlEncodeJQ(t),addNode($("#user_path").val(),t,"info-right"),requesAnswer(t))}),$("#submitQuestion").click(function(){requesQuest($("#question").val(),$("#answer").val())}),$("#learnModel").click(function(){"1"!=$("#auth_robot").val()?alert("你没有权限调用"):$("#updateBrain").modal("show")}),$("#normalModel").click(function(){alert("已是普通模式")}),$("#flirtModel").click(function(){alert("太污了，暂未开放")}),mobileMenuOutsideClick()});var mobileMenuOutsideClick=function(){$(".js-fh5co-nav-toggle").on("click",function(t){t.preventDefault();var e=$(this);$("body").hasClass("offcanvas")?(e.removeClass("active"),$("body").removeClass("offcanvas")):(e.addClass("active"),$("body").addClass("offcanvas"))}),$(document).click(function(t){var e=$("#fh5co-aside, .js-fh5co-nav-toggle");e.is(t.target)||0!==e.has(t.target).length||$("body").hasClass("offcanvas")&&($("body").removeClass("offcanvas"),$(".js-fh5co-nav-toggle").removeClass("active"))}),$(window).scroll(function(){$("body").hasClass("offcanvas")&&($("body").removeClass("offcanvas"),$(".js-fh5co-nav-toggle").removeClass("active"))})};